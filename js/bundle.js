var PlaceIn;(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Editor:()=>vt,EditorTools:()=>mt});class s{constructor(){}get type(){return""}translate(t,e){}render(t){this.renderControl(t)}onMove(t,e){}renderControl(t){}createPointDragHandler(t,e,s){return null}createMoveDragHandler(t,e,s){return null}createExtendDragHandler(t,e,s){return null}createSelectionControl(){return null}isPointInControl(t,e,s=0){return!1}}class n{static radiansToDegrees(t){return t*(180/Math.PI)}static degreesToRadians(t){return t*(Math.PI/180)}static angle(t,e,s,n){const o=this.radian(t,e,s,n);return this.radiansToDegrees(o)}static radian(t,e,s,n){return Math.atan2(n-e,s-t)}static radianInPoint(t,e){return this.radian(t.x,t.y,e.x,e.y)}static calculate3PointRadian(t,e,s,n,o,i){const r=this.radian(t,e,s,n);let a=this.radian(t,e,o,i)-r;return a<0&&(a+=2*Math.PI),a}static calculate3PointRadianInPoint(t,e,s){return this.calculate3PointRadian(t.x,t.y,e.x,e.y,s.x,s.y)}static calculate3PointDegrees(t,e,s,n,o,i){return this.radiansToDegrees(this.calculate3PointRadian(t,e,s,n,o,i))}static calculate3PointAngle(...t){let e,s,n,o,i,r;if(6===t.length)[e,s,n,o,i,r]=t;else{if(3!==t.length)throw new Error("올바른 인자를 제공하세요.");{const[a,h,l]=t;e=a.x,s=a.y,n=h.x,o=h.y,i=l.x,r=l.y}}const a=Math.atan2(o-s,n-e);let h=Math.atan2(r-s,i-e)-a;return h<0&&(h+=2*Math.PI),this.radiansToDegrees(h)}static distance(t,e,s,n){const o=s-t,i=n-e;return Math.sqrt(o**2+i**2)}static distanceInPoint(t,e){const s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s**2+n**2)}static isBetween(t,e,s,n=!1){return n&&(t=Math.round(t),e=Math.round(e),s=Math.round(s)),t>=e&&t<=s||t>=s&&t<=e}static distancePoint(t,e,s){const n=Math.atan2(e.y-t.y,e.x-t.x),i=new o(0,0);return i.x=t.x-s*Math.cos(n),i.y=t.y-s*Math.sin(n),i}static rotate(t,e,s,n,o){const i=t-s,r=e-n;return[i*Math.cos(o)-r*Math.sin(o)+s,i*Math.sin(o)+r*Math.cos(o)+n]}static rotatePoint(t,e,s,n){const i=t.x-e,r=t.y-s,a=i*Math.cos(n)-r*Math.sin(n),h=i*Math.sin(n)+r*Math.cos(n);return new o(a+e,h+s)}static interceptPoint(t,e,s,n,i,r,a,h){const l=(t-s)*(r-h)-(e-n)*(i-a);if(0===l)return null;const d=((t-i)*(r-h)-(e-r)*(i-a))/l;if(d>0&&d<1&&-((t-s)*(e-r)-(e-n)*(t-i))/l>0){const l=new o(0,0);return l.x=Math.round(t+d*(s-t)),l.y=Math.round(e+d*(n-e)),this.isPointInBox(l.x,l.y,t,e,s,n)&&this.isPointInBox(l.x,l.y,i,r,a,h)?l:null}return null}static isPointInBox(t,e,s,n,o,i){let r=Math.min(s,o),a=Math.max(s,o),h=Math.min(n,i),l=Math.max(n,i);return r===a&&(r-=1,a+=1),h===l&&(h-=1,l+=1),t>=r&&t<=a&&e>=h&&e<=l}}class o{constructor(t,e){this.x=t,this.y=e}copy(){return new o(this.x,this.y)}copyFrom(t){t&&(this.x=t.x,this.y=t.y)}distance(t,e){return n.distance(this.x,this.y,t,e)}static rotate(t,e,s,i){const r=[];for(const a of t){const t=n.rotate(a.x,a.y,e,s,i);r.push(new o(t[0],t[1]))}return r}}class i{constructor(){this.points=[]}addPoint(t){t&&(this.points.some((e=>e.x===t.x&&e.y===t.y))||this.points.push(t))}}class r{constructor(){this.points=[]}get count(){return this.points.length}add(t,e){this.points.push(new o(t,e))}first(){return this.count>1?this.points[0]:null}last(){return this.count>1?this.points[this.count-1]:null}rotate(t,e,s){for(const o of this.points){const i=n.rotate(o.x,o.y,t,e,s);o.x=i[0],o.y=i[1]}}contains(){let t,e;if(1===arguments.length&&"object"==typeof arguments[0]&&"x"in arguments[0]&&"y"in arguments[0])t=arguments[0].x,e=arguments[0].y;else{if(2!==arguments.length)throw new Error("Invalid arguments. Either provide (x, y) or a single Point object.");t=arguments[0],e=arguments[1]}let s=!1;for(let n=0,o=this.points.length-1;n<this.points.length;o=n++){if(this.points[n].x===t&&this.points[n].y===e)return!0;const i=this.points[n].x,r=this.points[n].y,a=this.points[o].x,h=this.points[o].y;r>e!=h>e&&t<(a-i)*(e-r)/(h-r)+i&&(s=!s)}return s}containsInPoint(t){return this.contains(t.x,t.y)}static createOuterPolygon(t,e,s,o=0){const i=new r,a=n.distancePoint(t,e,o),h=n.distancePoint(e,t,o),l=n.distance(a.x,a.y,h.x,h.y),d=n.radian(a.x,a.y,h.x,h.y),c=s/2;return i.add(a.x,a.y-c),i.add(a.x,a.y+c),i.add(a.x+l,a.y+c),i.add(a.x+l,a.y-c),i.rotate(a.x,a.y,d),i}static isPointInPolygon(t,e,s){const n=new r;return n.points=t,n.contains(e,s)}}class a{constructor(){this.x=0,this.y=0}static createVector(t,e,s,n){const o=new a;return o.x=s-t,o.y=n-e,o}getLength(){return Math.sqrt(this.x**2+this.y**2)}static createVectorOfPoints(t,e){return this.createVector(t.x,t.y,e.x,e.y)}dotProduct(t){return this.x*t.x+this.y*t.y}}class h{constructor(){this.start=new o(0,0),this.end=new o(0,0)}static create(t,e,s,n){const o=new h;return o.x1=t,o.y1=e,o.x2=s,o.y2=n,o}get slope(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}get x1(){return this.start.x}set x1(t){this.start.x=t}get y1(){return this.start.y}set y1(t){this.start.y=t}get x2(){return this.end.x}set x2(t){this.end.x=t}get y2(){return this.end.y}set y2(t){this.end.y=t}get width(){return Math.abs(this.end.x-this.start.x)}get height(){return Math.abs(this.end.y-this.start.y)}get length(){return Math.sqrt(Math.pow(this.end.x-this.start.x,2)+Math.pow(this.end.y-this.start.y,2))}get radian(){return n.radian(this.start.x,this.start.y,this.end.x,this.end.y)}get angle(){return n.radiansToDegrees(this.radian)}intercept(t,e){const s=this.slope;return s*t+(this.start.y-s*this.start.x)===e}rect(){const t=new l;return t.x=Math.min(this.start.x,this.end.x),t.y=Math.min(this.start.y,this.end.y),t.width=this.width,t.height=this.height,t}}class l{constructor(){this.x=0,this.y=0,this.width=0,this.height=0}static create(t,e,s,n){const o=new l;return o.x=t,o.y=e,o.width=s,o.height=n,o}points(){return[new o(this.x,this.y),new o(this.x+this.width,this.y),new o(this.x+this.width,this.y+this.height),new o(this.x,this.y+this.height)]}getTopLeftPoint(){const t=Math.min(this.x,this.x+this.width),e=Math.min(this.y,this.y+this.height);return new o(t,e)}getTopRightPoint(){const t=Math.max(this.x,this.x+this.width),e=Math.min(this.y,this.y+this.height);return new o(t,e)}getBottomLeftPoint(){const t=Math.min(this.x,this.x+this.width),e=Math.max(this.y,this.y+this.height);return new o(t,e)}getBottomRightPoint(){const t=Math.max(this.x,this.x+this.width),e=Math.max(this.y,this.y+this.height);return new o(t,e)}segments(){const t=[];return t.push({x1:this.x,y1:this.y,x2:this.x+this.width,y2:this.y}),t.push({x1:this.x+this.width,y1:this.y,x2:this.x+this.width,y2:this.y+this.height}),t.push({x1:this.x+this.width,y1:this.y+this.height,x2:this.x,y2:this.y+this.height}),t.push({x1:this.x,y1:this.y+this.height,x2:this.x,y2:this.y}),t}isPointInRect(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}translate(t,e){this.x+=t,this.y+=e}}class d extends s{constructor(t,e){super(),this.start=t,this.end=e,this.thick=10,this.color="#000000"}get length(){return n.distance(this.start.x,this.start.y,this.end.x,this.end.y)}isPointInControl(t,e,s=0){return this.createOuterPolygon(s).contains(t,e)}createOuterPolygon(t=0){return r.createOuterPolygon(this.start,this.end,this.thick,t)}}class c{constructor(t,e){this.A=t,this.B=e}static createEquationFrom4Point(t,e,s,n){return s-t==0?new c("v",t):n-e==0?new c("h",e):new c((n-e)/(s-t),n-s*((n-e)/(s-t)))}closestPoint(t,e){if("v"===this.A)return{x:this.B,y:e};if("h"===this.A)return{x:t,y:this.B};const s=(this.A*e+t-this.A*this.B)/(this.A*this.A+1);return{x:s,y:this.A*s+this.B}}distance(t,e){const s=this.closestPoint(t,e);return Math.sqrt((t-s.x)**2+(e-s.y)**2)}createPerpendicularEquation(t,e){return"string"!=typeof this.A?new c(-1/this.A,e- -1/this.A*t):"h"===this.A?new c("v",t):"v"===this.A?new c("h",e):void 0}createMoveEquation(t,e){return"v"===this.A?new c("v",t):"h"===this.A?new c("h",e):new c(this.A,e-t*this.A)}intersection(t){let e=null;if(this.A===t.A&&(e=null),"v"===this.A&&"h"===t.A&&(e=new o(this.B,t.B)),"h"===this.A&&"v"===t.A&&(e=new o(t.B,this.B)),"h"===this.A&&"v"!==t.A&&"h"!==t.A&&(e=new o((this.B-t.B)/t.A,this.B)),"v"===this.A&&"v"!==t.A&&"h"!==t.A&&(e=new o(this.B,t.A*this.B+t.B)),"h"===t.A&&"v"!==this.A&&"h"!==this.A&&(e=new o((t.B-this.B)/this.A,t.B)),"v"===t.A&&"v"!==this.A&&"h"!==this.A&&(e=new o(t.B,this.A*t.B+this.B)),"h"!==this.A&&"v"!==this.A&&"v"!==t.A&&"h"!==t.A){const s=(t.B-this.B)/(this.A-t.A),n=this.A*s+this.B;e=new o(s,n)}return e}}class u{onDragStart(t,e,s){}onDrag(t,e){}onDragStop(t,e){}onCancel(){}}class x{static Colors={Blue10:"#E5F2FF",Blue20:"#CCE4FF",Blue30:"#99CAFF",Blue40:"#66AFFF",Blue50:"#3395FF",Blue60:"#007AFF",Blue70:"#0062CC",Blue80:"#004999",Blue90:"#003166",Blue100:"#001833",BlueHover10:"#DAE6F2",BlueHover20:"#C2D9F2",BlueHover30:"#91C0F2",BlueHover40:"#61A6F2",BlueHover50:"#308EF2",BlueHover60:"#0D81FF",BlueHover70:"#0D6ACF",BlueHover80:"#0D529E",BlueHover90:"#0D3B6E",BlueHover100:"#0D243D",Purple10:"#F7EEFC",Purple20:"#EFDCF8",Purple30:"#DFBAF2",Purple40:"#CF97EB",Purple50:"#BF75E5",Purple60:"#AF52DE",Purple70:"#8C42B2",Purple80:"#693185",Purple90:"#462159",Purple100:"#23102C",PurpleHorver10:"#EBE2EF",PurpleHorver20:"#E3D1EC",PurpleHorver30:"#D4B1E6",PurpleHorver40:"#C58FDF",PurpleHorver50:"#B56FDA",PurpleHorver60:"#B35BE0",PurpleHorver70:"#924BB6",PurpleHorver80:"#713B8B",PurpleHorver90:"#4F2C61",PurpleHorver100:"#2E1C37",Cyan10:"#EAF7FC",Cyan20:"#D6EFFA",Cyan30:"#ADDEF5",Cyan40:"#84CEF0",Cyan50:"#5BBDEB",Cyan60:"#32ADE6",Cyan70:"#288AB8",Cyan80:"#1E688A",Cyan90:"#14455C",Cyan100:"#0A232E",CyanHover10:"#DEEBEF",CyanHover20:"#CBE3ED",CyanHover30:"#A4D3E9",CyanHover40:"#7DC4E4",CyanHover50:"#56B4DF",CyanHover60:"#3CB1E7",CyanHover70:"#3390BC",CyanHover80:"#297090",CyanHover90:"#204E64",CyanHover100:"#162E38",Teal10:"#EAF7F9",Teal20:"#D6EFF4",Teal30:"#ACDFE9",Teal40:"#83D0DD",Teal50:"#59C0D2",Teal60:"#30B0C7",Teal70:"#268D9F",Teal80:"#1D6A77",Teal90:"#134650",Teal100:"#0A2328",TealHover10:"#DEEBED",TealHover20:"#CBE3E8",TealHover30:"#A3D4DD",TealHover40:"#7CC6D2",TealHover50:"#55B6C7",TealHover60:"#3AB4CA",TealHover70:"#3193A4",TealHover80:"#28717E",TealHover90:"#1F4F59",TealHover100:"#162E33",Manneta10:"#FAE9F1",Manneta20:"#F6D4E3",Manneta30:"#EDA9C6",Manneta40:"#E37DAA",Manneta50:"#DA528D",Manneta60:"#D12771",Manneta70:"#A71F5A",Manneta80:"#7D1744",Manneta90:"#54102D",Manneta100:"#2A0817",MannetaHover10:"#EDDDE5",MannetaHover20:"#EAC9D8",MannetaHover30:"#E1A1BC",MannetaHover40:"#D877A1",MannetaHover50:"#CF4E86",MannetaHover60:"#D33278",MannetaHover70:"#AB2A62",MannetaHover80:"#83234D",MannetaHover90:"#5D1C38",MannetaHover100:"#351423",Red10:"#FFEBEA",Red20:"#FFD8D6",Red30:"#FFB1AC",Red40:"#FF8983",Red50:"#FF6259",Red60:"#FF3B30",Red70:"#CC2F26",Red80:"#99231D",Red90:"#661813",Red100:"#330C0A",RedHover10:"#F2DFDE",RedHover20:"#F2CDCB",RedHover30:"#F2A8A3",RedHover40:"#F2827C",RedHover50:"#F25D55",RedHover60:"#FF453A",RedHover70:"#CF3931",RedHover80:"#9E2E28",RedHover90:"#6E241F",RedHover100:"#3D1816",Green10:"#EBF9EE",Green20:"#D6F4DE",Green30:"#AEE9BD",Green40:"#85DD9B",Green50:"#5DD27A",Green60:"#34C759",Green70:"#2A9F47",Green80:"#1F7735",Green90:"#155024",Green100:"#0A2812",GreenHover10:"#DFEDE2",GreenHover20:"#CBE8D3",GreenHover30:"#A5DDB4",GreenHover40:"#7ED293",GreenHover50:"#58C774",GreenHover60:"#3ECA61",GreenHover70:"#35A450",GreenHover80:"#2A7E3F",GreenHover90:"#21592F",GreenHover100:"#16331E",Orange10:"#FFF4E5",Orange20:"#FFEACC",Orange30:"#FFD599",Orange40:"#FFBF66",Orange50:"#FFAA33",Orange60:"#FF9500",Orange70:"#CC7700",Orange80:"#995900",Orange90:"#663C00",Orange100:"#331E00",OrangeHover10:"#F2E8DA",OrangeHover20:"#F2DEC2",OrangeHover30:"#F2CA91",OrangeHover40:"#F2B561",OrangeHover50:"#F2A130",OrangeHover60:"#FF9A0D",OrangeHover70:"#CF7E0D",OrangeHover80:"#9E610D",OrangeHover90:"#6E460D",OrangeHover100:"#3D290D"};static get activeColor(){return"rgb(0,151,197)"}static get activeColor(){return"rgb(0,151,197)"}static get activeColorTransparent(){return"rgb(0, 151, 197, 0.8)"}static get selectColor(){return"rgba(0,151,197,0.5)"}}class y extends s{constructor(t,e){super(),this.start=t,this.end=e,this.height=15,this.padding=10,this.points=[],this.thick=1,this.strokeColor=x.activeColor,this.fillColor=x.activeColor}addPoint(t){t&&this.points.push(t)}render(t){const e=n.radianInPoint(this.start,this.end);t.save(),t.translate(this.start.x,this.start.y),t.rotate(e),this.renderRuler(t,this.start.x,this.start.y,-e,!0),this.renderRuler(t,this.start.x,this.start.y,-e,!1),t.restore()}renderRuler(t,e,s,n,o){t.lineWidth=this.thick,t.strokeStyle=this.strokeColor,t.fillStyle=this.fillColor,t.font="10px Arial";for(const i of this.createSegment(e,s,n,o)){const{start:e,end:s}=i;t.line(e.x,e.y,e.x,e.y+this.height),t.line(e.x,e.y,e.x,e.y-this.height),t.line(s.x,s.y,s.x,s.y+this.height),t.line(s.x,s.y,s.x,s.y-this.height),t.line(e.x,e.y,s.x,s.y),t.arrow(e.x,e.y,5,"left"),t.arrow(s.x,s.y,5,"right"),t.text((e.x+s.x)/2,e.y-10,`${Math.round(i.length)} px`)}}createSegment(t,e,s,n){const o=this.createRotatedPoints(t,e,s);n?e+=this.padding+this.height:e-=this.padding+this.height;const i=[];for(let s=0;s<o.length-1;s++){const n=new h;n.start={x:o[s].x-t,y:o[s].y-e},n.end={x:o[s+1].x-t,y:o[s+1].y-e},i.push(n)}return i}createSegments(){const t=this.createPoints(),e=[];for(let s=0;s<t.length-1;s++){const n=new h;n.start={x:t[s].x,y:t[s].y},n.end={x:t[s+1].x,y:t[s+1].y},e.push(n)}return e}createPoints(){return[this.start,...this.points,this.end]}rotateSegmentPoints(t,e,s,n){t.forEach((t=>{t.start=o.rotate(t.start,e,s,n),t.end=o.rotate(t.end,e,s,n)}))}rotateSegment(t,e,s,o){t.start=n.rotatePoint(t.start,e,s,o),t.end=n.rotatePoint(t.end,e,s,o)}createRotatedPoints(t,e,s){return o.rotate([this.start,...this.points,this.end],t,e,s)}}class w extends u{constructor(t,e,s,n){super(),this.floor=t,this.wall=e,this.fixedPoint=s,this.movePoint=n,this.originalMovePoint=this.movePoint.copy(),this.rotatedAngle=0,this.controls=[],this.ruler=new y(this.wall.start,this.wall.end),this.started=!1}onDragStart(t,e,s){t.addForegroundControl(this.ruler),this.started=!0}onDrag(t,e){if(this.started){const s=n.radianInPoint(this.fixedPoint,this.movePoint);this.movePoint.x=t,this.movePoint.y=e;const o=n.radianInPoint(this.fixedPoint,this.movePoint);this.rotate(o-s)}}rotate(t){this.rotatedAngle+=t;for(const e of this.controls)[e.start,e.end].map((e=>{const s=n.rotate(e.x,e.y,this.fixedPoint.x,this.fixedPoint.y,t);e.x=s[0],e.y=s[1]}))}onDragStop(t,e){if(this.started){this.started=!1;const t=this.wall.createOuterPolygon();for(const e of this.controls)t.containsInPoint(e.start)&&t.containsInPoint(e.end)||this.floor.removeControl(e)}this.floor.removeForegroundControl(this.ruler)}onCancel(){this.movePoint.copyFrom(this.originalMovePoint),this.rotate(-this.rotatedAngle),this.rotatedAngle=0,this.started=!1}}class g extends u{constructor(t,e,s){super(),this.floor=t,this.wall=e,this.handlers=[],this.equation=this.wall.createEquation();const{start:n,end:o}=this.wall;this.startPointEquation=this.equation.createPerpendicularEquation(n.x,n.y),this.endPointEquation=this.equation.createPerpendicularEquation(o.x,o.y),this.startCandidates=[],this.endCandidates=[],this.childs=s}addHandler(t){for(const e of t)this.handlers.push(e)}onDrag(t,e){this.equation=this.equation.createMoveEquation(t,e);const s=this.calculateStartPoint(t,e),n=this.calculateEndPoint(t,e);this.wall.start.copyFrom(s),this.wall.end.copyFrom(n);for(const t of this.handlers)t.onMove(this.floor,this.wall,this.equation);if(this.childs)for(const t of this.childs)t.start.copyFrom(this.equation.closestPoint(t.start.x,t.start.y)),t.end.copyFrom(this.equation.closestPoint(t.end.x,t.end.y))}calculateStartPoint(t,e){if(0===this.startCandidates.length)return this.equation.intersection(this.startPointEquation);if(1===this.startCandidates.length)return this.equation.intersection(this.startCandidates[0].equation);if(2===this.startCandidates.length){const t=this.equation.intersection(this.startCandidates[0].equation);if(n.isBetween(t.x,this.startCandidates[0].wall.start.x,this.startCandidates[0].wall.end.x)&&n.isBetween(t.y,this.startCandidates[0].wall.start.y,this.startCandidates[0].wall.end.y))return t;const e=this.equation.intersection(this.startCandidates[1].equation);if(n.isBetween(e.x,this.startCandidates[1].wall.start.x,this.startCandidates[1].wall.end.x)&&n.isBetween(e.y,this.startCandidates[1].wall.start.y,this.startCandidates[1].wall.end.y))return e}}calculateEndPoint(t,e){if(0===this.endCandidates.length)return this.equation.intersection(this.endPointEquation);if(1===this.endCandidates.length)return this.equation.intersection(this.endCandidates[0].equation);if(2===this.endCandidates.length){const t=this.equation.intersection(this.endCandidates[0].equation);if(n.isBetween(t.x,this.endCandidates[0].wall.start.x,this.endCandidates[0].wall.end.x)&&n.isBetween(t.y,this.endCandidates[0].wall.start.y,this.endCandidates[0].wall.end.y))return t;const e=this.equation.intersection(this.endCandidates[1].equation);if(n.isBetween(e.x,this.endCandidates[1].wall.start.x,this.endCandidates[1].wall.end.x)&&n.isBetween(e.y,this.endCandidates[1].wall.start.y,this.endCandidates[1].wall.end.y))return e}}}class f{constructor(t,e,s){this.follow=t,this.point=e,this.which=s}onMove(t,e,s){"start"===this.which?this.point.copyFrom(e.start):this.point.copyFrom(e.end)}}class p{constructor(t,e){this.follower=t,this.which=e,this.start=this.follower.start.copy(),this.end=this.follower.end.copy(),this.polygon=this.follower.createOuterPolygon()}onMove(t,e,s){const i=new o(0,0);"start"===this.which?i.copyFrom(e.start):i.copyFrom(e.end);const{start:r,end:a}=this.follower;this.isPointOnWall(i.x,i.y)?this.restorePoints():n.distanceInPoint(r,i)>n.distanceInPoint(a,i)?this.changeEndPoint(i):this.changeStartPoint(i)}changeStartPoint(t){this.follower.start.copyFrom(t)}changeEndPoint(t){this.follower.end.copyFrom(t)}restorePoints(){this.changeStartPoint(this.start),this.changeEndPoint(this.end)}isPointOnWall(t,e){return this.polygon.contains(t,e)}}class C{constructor(){this.followers=[]}addFollow(t,e){t&&this.followers.push({wall:t,point:e,equation:t.createEquation()})}onMove(t,e,s){const n=this.moveFollowers(e,s);this.removeFollowers(t,n)}moveFollowers(t,e){for(const s of this.followers){const o=e.intersection(s.equation);n.isBetween(o.x,t.start.x,t.end.x)&&n.isBetween(o.y,t.start.y,t.end.y)&&(s.point.x=o.x,s.point.y=o.y)}return[]}removeFollowers(t,e){for(const s of e)t.removeControl(s.wall),this.followers.splice(this.followers.indexOf(s),1)}}class v extends u{constructor(t,e,s){super(),this.fixedStart=t.copy(),this.fixedEnd=e.copy(),this.start=t,this.end=e,this.equation=s}onDragStart(t,e,s){this.startVector=a.createVector(e,s,this.start.x,this.start.y),this.endVector=a.createVector(e,s,this.end.x,this.end.y)}onDrag(t,e){this.startVector=a.createVector(t,e,this.fixedStart.x,this.fixedStart.y),this.endVector=a.createVector(t,e,this.fixedEnd.x,this.fixedEnd.y),this.startVector.dotProduct(this.endVector)<0||(this.start.x=this.fixedStart.x,this.start.y=this.fixedStart.y,this.end.x=this.fixedEnd.x,this.end.y=this.fixedEnd.y)}}class m extends s{constructor(t){super(),this.control=t}get type(){return"window-select"}render(t){this.control&&(t.save(),this.renderPoints(t,[this.control.start,this.control.end]),this.renderLines(t,[this.control.start,this.control.end]),t.restore())}renderPoints(t,e){t.fillStyle=x.activeColor;for(const s of e)t.circle(s.x,s.y,10),t.fill()}renderLines(t,e){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length;s++)t.lineTo(e[s].x,e[s].y);t.closePath(),t.lineWidth=2,t.strokeStyle=x.selectColor,t.stroke()}}class P extends d{constructor(t,e){super(t,e)}get type(){return"wall"}cutting(t,e,s){const n={x:this.end.x,y:this.end.y};this.end.x=e,this.end.y=s,t.createWall(e,s,n.x,n.y).thick=this.thick}createPointDragHandler(t,e,s){let n=null;return this.start.distance(e,s)<10?n=new w(t,this,this.end,this.start):this.end.distance(e,s)<10&&(n=new w(t,this,this.start,this.end)),n&&n.controls.push(...t.findControlsOnWall(this)),n}createExtendDragHandler(t,e,s){return this.isPointInControl(e,s)?new v(this.start,this.end):null}createMoveDragHandler(t,e,s){if(this.isPointInControl(e,s)){const e=new g(t,this,t.findControlsOnWall(this));return e.addHandler(this.createStartPointHandlers(t,e)),e.addHandler(this.createEndPointHandlers(t,e)),e.addHandler(this.createStartPointExtendHandlers(t,e)),e.addHandler(this.createEndPointExtendHandlers(t,e)),e.addHandler(this.createWallHandlers(t)),e}return null}createStartPointHandlers(t,e){const s=[],n=t.getConnectedWallsFromPoint(this,this.start,this.end);return 1===n.length&&(e.startPointEquation=n[0].wall.createEquation(),s.push(new f(n[0].wall,n[0].point,"start"))),s}createStartPointExtendHandlers(t,e){const s=[],n=t.getWallFromPoint(this,this.start);return n&&(e.startPointEquation=n.createEquation(),s.push(new p(n,"start"))),s}createEndPointExtendHandlers(t,e){const s=[],n=t.getWallFromPoint(this,this.end);return n&&(e.endPointEquation=n.createEquation(),s.push(new p(n,"end"))),s}createEndPointHandlers(t,e){const s=[],n=t.getConnectedWallsFromPoint(this,this.end,this.start);return 1===n.length&&(e.endPointEquation=n[0].wall.createEquation(),s.push(new f(n[0].wall,n[0].point,"end"))),s}createPointHandlers(t,e,s,n){const o=[];if(s)if(s.point)if(s.angle>175&&s.angle<185)if("start"===n){const e=new P(this.start.copy(),this.start.copy());e.thick=this.thick,t.walls.push(e),o.push(new f(e,e.end,n))}else{const e=new P(this.end.copy(),this.end.copy());e.thick=this.thick,t.walls.push(e),o.push(new f(e,e.end,n))}else"start"===n?e.startPointEquation=s.wall.createEquation():e.endPointEquation=s.wall.createEquation(),o.push(new f(s.wall,s.point,n));else"start"===n?e.startPointEquation=s.wall.createEquation():e.endPointEquation=s.wall.createEquation(),o.push(new p(s.wall,n));return o}createWallHandlers(t){const e=new C,s=t.getConnectedWallsFromWall(this);for(const t of s)e.addFollow(t.wall,t.point);return[e]}createSelectionControl(){return new m(this)}createEquation(){return c.createEquationFrom4Point(this.start.x,this.start.y,this.end.x,this.end.y)}createPerpendicularEquation(t,e){if(1===arguments.length){const e=t;if(e instanceof o)return this.createEquation().createPerpendicularEquation(e.x,e.y)}else if(arguments.length>=2)return this.createEquation().createPerpendicularEquation(t,e);return null}distance(t,e){return this.createEquation().distance(t,e)}createClosestPoint(t,e){return this.createEquation().closestPoint(t,e)}createDistancePoint(t,e,s){const n=this.createEquation().closestPoint(t,e),o=Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x);return{x:n.x+s*Math.cos(o),y:n.y+s*Math.sin(o)}}isPointOnBoundary(t){const{start:e,end:s}=this,n=Math.min(e.x,s.x),o=Math.max(e.x,s.x),i=Math.min(e.y,s.y),r=Math.max(e.y,s.y);return t.x>=n&&t.x<=o&&t.y>=i&&t.y<=r}renderControl(t){t.save(),t.beginPath(),t.lineWidth=this.thick,t.strokeStyle=this.color,t.moveTo(this.start.x,this.start.y),t.lineTo(this.end.x,this.end.y),t.closePath(),t.stroke(),t.restore()}}class D extends s{constructor(t){super(),this.room=t}get type(){return"room-select"}render(t){this.room.points.length>0&&(t.save(),this.renderPoints(t,this.room.points),this.renderLines(t,this.room.points),t.restore())}renderPoints(t,e){t.fillStyle=x.selectColor;for(const s of e)t.circle(s.x,s.y,10),t.fill()}renderLines(t,e){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let s=1;s<e.length;s++)t.lineTo(e[s].x,e[s].y);t.closePath(),t.lineWidth=2,t.strokeStyle=x.selectColor,t.stroke()}}class F extends u{constructor(t){super(),this.points=t,this.points.length>1&&console.log(this.points)}addPoint(t){this.points.push(t)}onDragStart(t,e,s){}onDrag(t,e){for(const s of this.points)s.x=t,s.y=e}onDragStop(t,e){for(const s of this.points)s.x=t,s.y=e}}class E extends s{constructor(t,e){super(),this.points=t,this.fillColor="rgba(131,208,221,0.5)",this.name=e,this.center=this.calculateCenterPoint()}get type(){return"room"}addPoint(t){this.existPoint(t)?console.log(`point(${t.x}, ${t.y}) already exist`):this.points.push(t)}existPoint(t){return this.points.some((e=>this.isSamePoint(e,t)))}isSamePoint(t,e){return Math.floor(t.x)===Math.floor(e.x)&&Math.floor(t.y)===Math.floor(e.y)}render(t){if(this.points.length>0){this.center=this.calculateCenterPoint(),t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(let e=1;e<this.points.length;e++)t.lineTo(this.points[e].x,this.points[e].y);t.closePath(),t.fillStyle=this.fillColor,t.fill(),t.font="10px Arial",t.fillStyle="#000000",t.text(this.center.x,this.center.y,this.name)}}getContainsX(t,e){for(const t of this.points)if(this.contains(t.x,e))return t.x;return t}calculateCenterPoint(){const t=new o(0,0),e=this.getMinMaxCoords();return t.x=(e.minX+e.maxX)/2,t.y=(e.minY+e.maxY)/2,this.contains(t.x,t.y)||(t.x=(this.getContainsX(t.x,t.y)+e.maxX)/2),t}contains(t,e){let s=!1;for(let n=0,o=this.points.length-1;n<this.points.length;o=n++){if(this.points[n].x===t&&this.points[n].y===e)return!0;const i=this.points[n].x,r=this.points[n].y,a=this.points[o].x,h=this.points[o].y;r>e!=h>e&&t<(a-i)*(e-r)/(h-r)+i&&(s=!s)}return s}getMinMaxCoords(){if(0===this.points.length)return 0;let t=this.points[0].x,e=this.points[0].y,s=this.points[0].x,n=this.points[0].y;for(let o=1;o<this.points.length;o++){const i=this.points[o];i.x<t&&(t=i.x),i.x>s&&(s=i.x),i.y<e&&(e=i.y),i.y>n&&(n=i.y)}return{minX:t,minY:e,maxX:s,maxY:n}}createPointDragHandler(t,e,s){const o=[];for(const t of this.points)n.distance(t.x,t.y,e,s)<10&&o.push(t);return o.length>0?new F(o):null}createMoveDragHandler(t,e,s){return this.isPointInControl(e,s)?new u:null}createSelectionControl(){return new D(this)}isPointInControl(t,e){return r.isPointInPolygon(this.points,t,e)}}class A extends u{constructor(t,e,s,n){super(),this.floor=t,this.wall=e,this.point=n,this.control=s,this.ruler=new y(this.wall.start,this.wall.end),this.ruler.addPoint(s.start),this.ruler.addPoint(s.end),this.cancelSnapshot={wall:e,point:n.copy()},this.started=!1}onDragStart(t,e,s){this.floor.addForegroundControl(this.ruler),this.started=!0}onDrag(t,e){if(!this.started)return;const s=this.wall.createClosestPoint(t,e);this.wall.isPointOnBoundary(s)&&this.point.copyFrom(s)}onDragStop(t,e){this.started=!1,this.removeControlsUnderThreshold(10),this.floor.removeForegroundControl(this.ruler)}onCancel(){this.started=!1,this.point.copyFrom(this.cancelSnapshot.point)}removeControlsUnderThreshold(t){this.control.length<t&&this.floor.removeControl(this.control)}}class M extends u{constructor(t,e,s){super(),this.floor=t,this.wall=e,this.control=s,this.startVector=0,this.endVector=0,this.ruler=new y(this.wall.start,this.wall.end),this.ruler.addPoint(this.control.start),this.ruler.addPoint(this.control.end),this.cancelSnapshot={wall:e,start:s.start.copy(),end:s.end.copy()},this.started=!1,this.reverse=n.distanceInPoint(this.wall.start,this.control.start)>n.distanceInPoint(this.wall.start,this.control.end)}onDragStart(t,e,s){const n=this.wall.createClosestPoint(e,s);this.startVector=a.createVectorOfPoints(n,this.control.start),this.endVector=a.createVectorOfPoints(n,this.control.end),this.floor.addForegroundControl(this.ruler),this.started=!0,this.startX=e,this.startY=s}onDrag(t,e){if(!this.started)return;const s=this.floor.getClosestWallOnCoordinates(t,e);s&&(this.wall=s);let n=null,o=null;this.reverse?(n=this.wall.createDistancePoint(t,e,this.startVector.getLength()),o=this.wall.createDistancePoint(t,e,-this.endVector.getLength())):(n=this.wall.createDistancePoint(t,e,-this.startVector.getLength()),o=this.wall.createDistancePoint(t,e,this.endVector.getLength())),this.wall.isPointOnBoundary(n)&&this.wall.isPointOnBoundary(o)&&(this.updateRuler(this.wall.start,this.wall.end),this.updateControl(n,o))}onDragStop(t,e){this.started&&(this.started=!1),this.floor.removeForegroundControl(this.ruler)}onCancel(){this.started=!1,this.updateRuler(this.cancelSnapshot.wall.start,this.cancelSnapshot.wall.end),this.updateControl(this.cancelSnapshot.start,this.cancelSnapshot.end)}updateRuler(t,e){this.ruler.start=t,this.ruler.end=e}updateControl(t,e){this.control.start.copyFrom(t),this.control.end.copyFrom(e)}}class S extends u{constructor(t){super(),this.control=t,this.startX=0,this.startY=0}onDragStart(t,e,s){this.started=!0,this.startX=e,this.startY=s}onDrag(t,e){const s=t-this.startX,n=e-this.startY;this.control.start.x+=s,this.control.start.y+=n,this.control.end.x+=s,this.control.end.y+=n,this.startX=t,this.startY=e}}class H extends u{constructor(t){super(),this.point=t}onDragStart(t,e,s){}onDrag(t,e){this.point.x=t,this.point.y=e}onDragStop(t,e){this.point.x=t,this.point.y=e}}class B extends u{constructor(t,e,s){super(),this.floor=t,this.wall=e,this.control=s,this.startVector=0,this.endVector=0,this.ruler=new y(this.wall.start,this.wall.end),this.ruler.addPoint(this.control.start),this.ruler.addPoint(this.control.end),this.cancelSnapshot={wall:e,start:s.start.copy(),end:s.end.copy()},this.started=!1,this.reverse=n.distanceInPoint(this.wall.start,this.control.start)>n.distanceInPoint(this.wall.start,this.control.end)}onDragStart(t,e,s){const n=this.wall.createClosestPoint(e,s);this.startVector=a.createVectorOfPoints(n,this.control.start),this.endVector=a.createVectorOfPoints(n,this.control.end),this.floor.addForegroundControl(this.ruler),this.started=!0,this.startX=e,this.startY=s}onDrag(t,e){if(!this.started)return;const s=this.floor.getClosestWallOnCoordinates(t,e);s&&(this.wall=s);let n=null,o=null;this.reverse?(n=this.wall.createDistancePoint(t,e,this.startVector.getLength()),o=this.wall.createDistancePoint(t,e,-this.endVector.getLength())):(n=this.wall.createDistancePoint(t,e,-this.startVector.getLength()),o=this.wall.createDistancePoint(t,e,this.endVector.getLength())),this.wall.isPointOnBoundary(n)&&this.wall.isPointOnBoundary(o)&&(this.updateRuler(this.wall.start,this.wall.end),this.updateControl(n,o))}onDragStop(t,e){this.started&&(this.started=!1),this.floor.removeForegroundControl(this.ruler)}onCancel(){this.started=!1,this.updateRuler(this.cancelSnapshot.wall.start,this.cancelSnapshot.wall.end),this.updateControl(this.cancelSnapshot.start,this.cancelSnapshot.end)}updateRuler(t,e){this.ruler.start=t,this.ruler.end=e}updateControl(t,e){this.control.start.copyFrom(t),this.control.end.copyFrom(e)}}class T extends s{constructor(){super(),this.x=0,this.y=0,this.text=null,this.background=null,this.color=null}get type(){return"tooltip"}render(t){if(!this.text)return;t.font="10px Arial bold";const e=t.measureText(this.text).width,s=parseInt(t.font);t.fillStyle=this.background?this.background:"rgba(255,59,48)",t.fillRect(this.x,this.y,e+10,s+10),t.fillStyle=this.color?this.color:"#ffffff",t.fillText(this.text,this.x+5,this.y+s+5)}}class R extends s{constructor(t){super(),this.door=t,this.tooltip=new T}get type(){return"door-select-control"}render(t){this.door&&(t.save(),this.renderPoints(t,[this.door.start,this.door.end,this.door.getControlPoint()]),t.restore(),this.door.length<10&&(this.tooltip.x=this.door.start.x,this.tooltip.y=this.door.start.y+10,this.tooltip.text="deleted",this.tooltip.render(t)))}renderPoints(t,e){t.fillStyle=x.activeColorTransparent;for(const s of e)t.circle(s.x,s.y,10),t.fill()}}class O extends u{constructor(t){super(),this.door=t,this.started=!1}onDragStart(t,e,s){this.started=!0}onDrag(t,e){if(!this.started)return;const s=this.calculateAngle(this.door.start.x,this.door.start.y,this.door.end.x,this.door.end.y,this.door.start.x,this.door.start.y,t,e);this.door.direction=s>=0&&s<=180?"right":"left",console.log(`direction : ${this.door.direction}`);const o=n.distance(this.door.start.x,this.door.start.y,t,e),i=n.distance(this.door.end.x,this.door.end.y,t,e);this.door.hidge=o>i?"end":"start"}angle(t,e){return n.angle(this.door.start.x,this.door.start.y,t,e)}onDragStop(t,e){this.started&&(this.started=!1)}createVector(t,e,s,n){return{x:s-t,y:n-e}}dotProduct(t,e){return t.x*e.x+t.y*e.y}vectorMagnitude(t){return Math.sqrt(t.x*t.x+t.y*t.y)}calculateAngle(t,e,s,n,o,i,r,a){var h=this.createVector(t,e,s,n),l=this.createVector(o,i,r,a),d=Math.atan2(l.y,l.x)-Math.atan2(h.y,h.x);return this.radiansToDegreesInRange(d)}radiansToDegreesInRange(t){for(var e=t*(180/Math.PI);e<0;)e+=360;for(;e>=360;)e-=360;return e}}class k extends d{constructor(t,e){super(t,e),this.hidge="start",this.direction="right"}get type(){return"door"}get angle(){return n.radianInPoint(this.start,this.end)}getControlPoint(){const t=this.length,e=this.angle-270*Math.PI/180;let s=0,n=0;return"right"===this.direction?"start"===this.hidge?(s=this.start.x+t*Math.cos(e),n=this.start.y+t*Math.sin(e)):(s=this.end.x+t*Math.cos(e),n=this.end.y+t*Math.sin(e)):"start"===this.hidge?(s=this.start.x-t*Math.cos(e),n=this.start.y-t*Math.sin(e)):(s=this.end.x-t*Math.cos(e),n=this.end.y-t*Math.sin(e)),new o(s,n)}render(t){t.save(),t.translate(this.start.x,this.start.y),t.rotate(this.angle),this.renderRect(t),this.renderDoor(t),t.restore()}renderRect(t){const e=this.length,s=10/3,n=new Path2D;n.rect(0,-5,e,10);for(let t=0;t<3;t++)n.rect(5,s*t-5,e-10,s);t.fillStyle="#ffffff",t.strokeStyle="#000000",t.fill(n),t.stroke(n)}renderDoor(t){const e=this.length,s=new Path2D,n=Math.PI/2,o=Math.PI,i=0+e;"start"===this.hidge?"right"===this.direction?(s.arc(0,0,e,0,n,!1),s.moveTo(0,0),s.lineTo(0,e)):(s.arc(0,0,e,-n,0,!1),s.moveTo(0,0),s.lineTo(0,-e)):"right"===this.direction?(s.arc(i,0,e,n,o,!1),s.moveTo(i,0),s.lineTo(i,e)):(s.arc(i,0,e,o,-n,!1),s.moveTo(i,0),s.lineTo(i,-e)),t.stroke(s)}createPointDragHandler(t,e,s){const n=t.getWallsOnCoordinates(this.start.x,this.start.y);return this.start.distance(e,s)<10?0===n.length?new H(this.start):new A(t,n[0],this,this.start):this.end.distance(e,s)<10?0===n.length?new H(this.end):new A(t,n[0],this,this.end):this.getControlPoint().distance(e,s)<10?new O(this):null}createMoveDragHandler(t,e,s){if(this.isPointInControl(e,s)){const e=t.getWallsOnCoordinates(this.start.x,this.start.y);return e.length>0?new B(t,e[0],this):new S(this)}return null}createSelectionControl(){return new R(this)}}class b extends s{constructor(t){super(),this.window=t,this.tooltip=new T}get type(){return"window-select-control"}render(t){this.window&&(t.save(),this.renderPoints(t,[this.window.start,this.window.end]),t.restore(),this.window.length<10&&(this.tooltip.x=this.window.start.x,this.tooltip.y=this.window.start.y+10,this.tooltip.text="deleted",this.tooltip.render(t)))}renderPoints(t,e){t.fillStyle=x.activeColorTransparent;for(const s of e)t.circle(s.x,s.y,10),t.fill()}}class q extends d{constructor(t,e){super(t,e)}get type(){return"window"}render(t){const e=n.radianInPoint(this.start,this.end),s=n.distanceInPoint(this.start,this.end),o=this.createWindowPath(s,10);t.save(),t.translate(this.start.x,this.start.y),t.rotate(e),t.lineWidth=1,t.strokeStyle="#000000",t.fillStyle="#ffffff",t.fill(o),t.stroke(o),t.restore()}createWindowPath(t,e){const s=e/3,n=new Path2D;n.rect(0,-5,t,e);for(let e=0;e<3;e++)n.rect(5,s*e-5,t-10,s);return n}createPointDragHandler(t,e,s){const n=t.getWallsOnCoordinates(this.start.x,this.start.y);return this.start.distance(e,s)<10?0===n.length?new H(this.start):new A(t,n[0],this,this.start):this.end.distance(e,s)<10?0===n.length?new H(this.end):new A(t,n[0],this,this.end):null}createMoveDragHandler(t,e,s){if(this.isPointInControl(e,s)){const e=t.getWallsOnCoordinates(this.start.x,this.start.y);return e.length>0?new M(t,e[0],this):new S(this)}return null}createSelectionControl(){return new b(this)}}class I{constructor(){this.rooms=[],this.walls=[],this.windows=[],this.doors=[],this.foregrounds=[]}clear(){this.rooms=[],this.walls=[],this.windows=[],this.doors=[],this.foregrounds=[]}load(t){this.clear(),t.rooms&&this.loadRooms(t.rooms),t.walls&&this.loadWalls(t.walls),t.windows&&this.loadWindows(t.windows),t.doors&&this.loadDoors(t.doors)}loadRooms(t){for(const e of t){const t=new E(e.points,e.name);this.rooms.push(t)}}loadWalls(t){for(const e of t){const{start:t,end:s}=e,n=new P(new o(t.x,t.y),new o(s.x,s.y));this.walls.push(n)}}loadWindows(t){for(const e of t){const{start:t,end:s}=e,n=new q(new o(t.x,t.y),new o(s.x,s.y));this.windows.push(n)}}loadDoors(t){for(const e of t){const{start:t,end:s}=e,n=new k(new o(t.x,t.y),new o(s.x,s.y));n.hidge=e.hidge,n.direction=e.direction,this.doors.push(n)}}render(t){this.renderFloor(t),this.renderForeground(t)}renderFloor(t){for(const e of this.rooms)e.render(t);for(const e of this.walls)e.render(t);for(const e of this.doors)e.render(t);for(const e of this.windows)e.render(t)}renderForeground(t){for(const e of this.foregrounds)e.render(t)}createWall(t,e,s,n){let i=this.findWall(t,e,s,n);return i||(i=new P(new o(t,e),new o(s,n)),this.walls.push(i)),i}findWall(t,e,s,n){for(const o of this.walls){const{start:i,end:r}=o;if(i.x===t&&i.y===e&&r.x===s&&r.y===n)return o;if(r.x===t&&r.y===e&&i.x===s&&i.y===n)return o}for(const o of this.walls){const i=o.createOuterPolygon(10);if(i.contains(t,e)&&i.contains(s,n))return o}return null}findControlsOnWall(t){const e=t.createOuterPolygon(),s=[];for(const t of this.doors)e.contains(t.start.x,t.start.y)&&e.contains(t.end.x,t.end.y)&&s.push(t);for(const t of this.windows)e.contains(t.start.x,t.start.y)&&e.contains(t.end.x,t.end.y)&&s.push(t);return s}removeControl(t){let e=this.walls.indexOf(t);if(-1!==e){this.walls.splice(e,1);for(const e of this.findControlsOnWall(t))this.removeControl(e)}e=this.windows.indexOf(t),-1!==e&&this.windows.splice(e,1),e=this.doors.indexOf(t),-1!==e&&this.doors.splice(e,1)}getControlsOnCoordinates(t,e,s=null){const n=[];for(const o of this.getAllControls())o.isPointInControl(t,e)&&(s&&s(o),n.push(o));return n}getWallsOnCoordinates(t,e,s=null){const n=[];for(const o of this.walls)o.isPointInControl(t,e)&&(s?s(o)&&n.push(o):n.push(o));return n}getWallFromPoint(t,e){const s=e=>t.start.x===e.x&&t.start.y===e.y||t.end.x===e.x&&t.end.y===e.y;for(const n of this.walls)if(t!==n&&!s(n.start)&&!s(n.end)&&n.isPointInControl(e.x,e.y))return n;return null}getClosestWallOnCoordinates(t,e){for(const s of this.walls)if(s.isPointInControl(t,e,10))return s;return null}getDoorsOnCoordinates(t,e,s=null){const n=[];for(const o of this.doors)o.isPointInControl(t,e)&&(s&&s(o),n.push(o));return n}getWindowsOnCoordinates(t,e,s=null){const n=[];for(const o of this.windows)o.isPointInControl(t,e)&&(s&&s(o),n.push(o));return n}cuttingRect(t,e,s,n){const o=l.create(t,e,s,n);for(const t of o.segments())this.cuttingLine(t.x1,t.y1,t.x2,t.y2);o.x-=1,o.y-=1,o.width+=2,o.height+=2;const i=[];for(const t of this.walls)o.isPointInRect(t.start)&&o.isPointInRect(t.end)&&i.push(t);for(const t of this.windows)o.isPointInRect(t.start)&&o.isPointInRect(t.end)&&i.push(t);for(const t of this.doors)o.isPointInRect(t.start)&&o.isPointInRect(t.end)&&i.push(t);for(const t of i)this.removeControl(t)}getConnectedWallsFromPoint(t,e,s){const o=[],i=a.createVectorOfPoints(e,s);for(const r of this.walls)if(r!==t){const{start:t,end:h}=r;n.distanceInPoint(t,e)<10?o.push({wall:r,point:t,angle:n.calculate3PointAngle(e,h,s),vector:a.createVectorOfPoints(t,h),dotProduct:i.dotProduct(a.createVectorOfPoints(t,h))}):n.distanceInPoint(h,e)<10&&o.push({wall:r,point:h,angle:n.calculate3PointAngle(e,t,s),vector:a.createVectorOfPoints(h,t),dotProduct:i.dotProduct(a.createVectorOfPoints(h,t))})}return o}getConnectedWallsFromWall(t){const e=e=>t.start.x===e.x&&t.start.y===e.y||t.end.x===e.x&&t.end.y===e.y,s=t.createOuterPolygon(5),n=[];for(const o of this.walls)if(o!==t){if(e(o.start)||e(o.end))continue;const{start:t,end:i}=o;s.contains(t)?n.push({wall:o,point:t}):s.contains(i)&&n.push({wall:o,point:i})}return n}cuttingLine(t,e,s,o){const i=[];for(const r of this.walls){const a=n.interceptPoint(t,e,s,o,r.start.x,r.start.y,r.end.x,r.end.y);a&&i.push({point:a,wall:r})}for(const t of i)t.wall.cutting(this,t.point.x,t.point.y)}addForegroundControl(t){t&&this.foregrounds.push(t)}removeForegroundControl(t){t&&(this.foregrounds=this.foregrounds.filter((e=>e!==t)))}removeAllForegroundControls(){this.foregrounds=[]}getAllControls(){return[...this.doors,...this.windows,...this.walls,...this.rooms]}}class W{render(t){}}class V extends W{constructor(t,e){super(),this.canvas=e,this.display=!t||!t.display||t.display,this.size=t&&t.size?t.size:100,this.color=t&&t.color?t.color:"#c2c1c1",this.thick=t&&t.thick?t.thick:1}render(t){if(this.display){t.save(),t.setTransform(1,0,0,1,0,0),t.beginPath(),t.strokeStyle=this.color,t.lineWidth=this.thick;for(let e=this.size;e<this.canvas.width;e+=this.size)t.moveTo(e,0),t.lineTo(e,this.canvas.height);for(let e=this.size;e<this.canvas.height;e+=this.size)t.moveTo(0,e),t.lineTo(this.canvas.width,e);t.stroke(),t.restore()}}}class L extends W{constructor(t,e=1,s=!1){super(),this.floor=t,this.alpha=e,this.displayVertex=s}render(t){t.save(),t.globalAlpha=this.alpha,this.floor.render(t),this.displayVertex&&this.renderVertex(t),t.restore()}renderVertex(t){const e=new i;for(const t of this.floor.walls)e.addPoint(t.start),e.addPoint(t.end);for(const s of e.points)t.beginPath(),t.arc(s.x,s.y,10,0,2*Math.PI),t.fillStyle="rgba(31,32,35,0.5)",t.fill()}}class X extends W{constructor(t){super(),this.floor=t}render(t){let e=1/0,s=1/0,n=-1/0,o=-1/0;for(const t of this.floor.walls){const{start:i,end:r}=t;e=Math.min(e,i.x,r.x),n=Math.max(n,i.x,r.x),s=Math.min(s,i.y,r.y),o=Math.max(o,i.y,r.y)}const i=50;this.renderLine(t,e,s-i,n,s-i),this.renderArrow(t,e,s-i,5,4),this.renderArrow(t,n,s-i,5,2),this.renderLine(t,n+i,s,n+i,o),this.renderArrow(t,n+i,s,5,1),this.renderArrow(t,n+i,o,5,3)}renderLine(t,e,s,n,o){t.beginPath(),t.strokeStyle="#666666",t.fillStyle="#666666",t.lineWidth=1,t.moveTo(e,s),t.lineTo(n,o),t.stroke()}renderArrow(t,e,s,n,o){switch(o){case 1:t.beginPath(),t.moveTo(e,s),t.lineTo(e-n,s+n),t.moveTo(e,s),t.lineTo(e+n,s+n),t.closePath(),t.stroke();break;case 2:t.beginPath(),t.moveTo(e,s),t.lineTo(e-n,s-n),t.moveTo(e,s),t.lineTo(e-n,s+n),t.closePath(),t.stroke();break;case 3:t.beginPath(),t.moveTo(e,s),t.lineTo(e-n,s-n),t.moveTo(e,s),t.lineTo(e+n,s-n),t.closePath(),t.stroke();break;case 4:t.beginPath(),t.moveTo(e,s),t.lineTo(e+n,s-n),t.moveTo(e,s),t.lineTo(e+n,s+n),t.closePath(),t.stroke()}}}class Y{constructor(){this.clientX=0,this.clientY=0,this.snapX=0,this.snapY=0,this.x=0,this.y=0}}class G{constructor(t){this.handlers=[],this.snapToGrid=!0,this.context=t}addHandler(t){t&&this.handlers.push(t)}removeHandler(t){t&&(this.handlers=this.handlers.filter((e=>e!==t)))}onClick(t){for(const e of this.handlers)e.onClick(t)}onKeyDown(t,e){for(const s of this.handlers)s.onKeyDown(t,e)}onMouseDown(t,e){const s=new Y;s.clientX=t,s.clientY=e;const n=this.transformPoint(t,e),o=this.snapPoint(n);s.snapX=o.x,s.snapY=o.y,s.x=n.x,s.y=n.y;for(const t of this.handlers)t.useSnap(),t.onMouseDown(s)}onMouseMove(t,e){const s=new Y;s.clientX=t,s.clientY=e;const n=this.transformPoint(t,e),o=this.snapPoint(n);s.snapX=o.x,s.snapY=o.y,s.x=n.x,s.y=n.y;for(const t of this.handlers)t.useSnap(),t.onMouseMove(s)}onMouseUp(t,e){const s=new Y;s.clientX=t,s.clientY=e;const n=this.transformPoint(t,e),o=this.snapPoint(n);s.snapX=o.x,s.snapY=o.y,s.x=n.x,s.y=n.y;for(const t of this.handlers)t.useSnap(),t.onMouseUp(s)}snap(t){return this.snapToGrid?10*Math.round(t/10):t}snapPoint(t){return{x:this.snap(t.x),y:this.snap(t.y)}}transformPoint(t,e){const s=this.context.getTransform(),n=s.e,o=s.f;return{x:t-n/s.a,y:e-o/s.d}}}class z{onCommandActive(t){}onCommandDeActive(t){}}class j{constructor(){}useSnap(){return!0}onClick(t){}onKeyDown(t,e){}onMouseDown(t){}onMouseMove(t){}onMouseUp(t){}}class U extends z{constructor(t){super(),this.handler=new _(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class _ extends j{constructor(t){super(),this.editor=t,this.hanlders=[],this.canvasmovehandler=new $(t)}useSnap(){return!1}onKeyDown(t,e){if("Backspace"===t){for(const t of this.editor.floor.walls)t.selected&&this.editor.floor.removeControl(t);this.editor.render()}else if("Escape"===t){for(const t of this.hanlders)t.onCancel();this.editor.render()}}onMouseDown(t){const e=this.editor.floor;for(const s of e.getAllControls()){const n=s.createPointDragHandler(e,t.x,t.y);n&&(this.editor.addSelectControls([s.createSelectionControl()]),this.hanlders.push(n))}if(0===this.hanlders.length){this.editor.selectControl(null,t.x,t.y);for(const s of e.getAllControls()){const n=s.createMoveDragHandler(e,t.x,t.y);if(n){this.editor.setSelectControls([s.createSelectionControl()]),this.hanlders.push(n);break}}}0===this.hanlders.length&&(this.editor.setSelectControls([]),this.editor.selectControl(null,t.x,t.y));for(const s of this.hanlders)s.onDragStart(e,t.x,t.y);0===this.hanlders.length&&this.canvasmovehandler.onDragStart(e,t.clientX,t.clientY),this.editor.render()}onMouseMove(t){for(const e of this.hanlders)e.onDrag(t.x,t.y);0===this.hanlders.length&&this.canvasmovehandler.onDrag(t.clientX,t.clientY),this.editor.render()}onMouseUp(t){for(const e of this.hanlders)e.onDragStop(t.x,t.y);0===this.hanlders.length&&this.canvasmovehandler.onDragStop(t.clientX,t.clientY),this.hanlders=[],this.editor.setSelectControls([]),this.editor.render(),this.editor.onChangeFloor()}}class $ extends u{constructor(t){super(),this.editor=t,this.startX=0,this.startY=0,this.started=!1}onDragStart(t,e,s){this.startX=e,this.startY=s,this.started=!0}onDrag(t,e){if(this.started){if(this.editor){const s=t-this.startX,n=e-this.startY;this.editor.translate(s,n)}this.startX=t,this.startY=e}}onDragStop(t,e){this.started=!1}}class K extends z{constructor(t,e){super(),this.handler=new J(t,e)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class J extends j{constructor(t,e){super(),this.editor=t,this.control=new N,this.started=!1,this.clear=e}onMouseDown(t){this.started=!0,this.control.initialize(t.snapX,t.snapY),this.editor.floor.addForegroundControl(this.control)}onMouseMove(t){this.started&&(this.control.move(t.snapX,t.snapY),this.editor.render())}onMouseUp(t){const e=this.editor.floor;if(e.removeForegroundControl(this.control),this.started){if(this.clear){const t=this.control.rect;e.cuttingRect(t.x,t.y,t.width,t.height)}for(const t of this.control.rect.segments())this.createWall(t);this.editor.render()}this.started=!1,this.editor.tools.select(),this.editor.onChangeFloor()}createWall(t){this.editor.floor.createWall(t.x1,t.y1,t.x2,t.y2)}}class N extends s{constructor(){super(),this.rect=new l,this.widthRuler=new y(this.start,this.end),this.heightRuler=new y(this.start,this.end)}initialize(t,e){this.rect.x=t,this.rect.y=e,this.rect.width=0,this.rect.height=0}move(t,e){this.rect.width=t-this.rect.x,this.rect.height=e-this.rect.y}render(t){t.save(),t.beginPath(),t.lineWidth=10,t.strokeStyle=x.activeColor,t.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),t.stroke(),t.closePath(),this.renderWidthRuler(t),this.renderHeightRuler(t),t.restore()}renderWidthRuler(t){this.widthRuler.start=this.rect.getTopLeftPoint(),this.widthRuler.end=this.rect.getTopRightPoint(),this.widthRuler.render(t)}renderHeightRuler(t){this.heightRuler.start=this.rect.getTopRightPoint(),this.heightRuler.end=this.rect.getBottomRightPoint(),this.heightRuler.render(t)}}class Q extends s{constructor(){super(),this.point=new o(0,0),this.wall=null}get type(){return"wall-position-indicator"}render(t){if(console.log(this.wall),console.log(this.point),this.wall){this.thick;const e=n.radianInPoint(this.wall.start,this.wall.end),s=new o(0,-this.wall.thick),i=new o(0,this.wall.thick);t.save(),t.translate(this.point.x,this.point.y),t.rotate(e),t.strokeStyle=x.activeColor,t.fillStyle=x.activeColor,t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(i.x,i.y),t.stroke(),t.arrow(s.x,s.y,8,"down"),t.arrow(i.x,i.y,8,"up"),t.restore()}}}class Z extends z{constructor(t){super(),this.handler=new tt(t,{minimumLength:20})}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class tt extends j{constructor(t,e){super(),this.config=e,this.ruler=null,this.editor=t,this.wall=null,this.window=null,this.indicator=new Q,this.editor.setSelectControls([this.indicator])}onMouseDown(t){let e=this.editor.floor.getControlsOnCoordinates(t.x,t.y,(t=>"wall"===t.type));if(e.length<=0)return;this.wall=e[0];const s=this.wall.createClosestPoint(t.x,t.y);this.window=new q(new o(s.x,s.y),new o(s.x,s.y)),this.ruler=new y(this.wall.start,this.wall.end),this.ruler.addPoint(this.window.start),this.ruler.addPoint(this.window.end),this.editor.setSelectControls([this.ruler])}onMouseMove(t){this.window?this.updateWindow(t.x,t.y):this.updateIndicator(t.x,t.y)}onMouseUp(t){this.window&&(this.editor.setSelectControls([]),this.window.length>this.config.minimumLength&&this.editor.floor.windows.push(this.window),this.wall=null,this.window=null,this.editor.render(),this.editor.tools.select(),this.editor.onChangeFloor())}updateWindow(t,e){const s=this.wall.createClosestPoint(t,e);this.wall.isPointOnBoundary(s)&&(this.window.end.x=s.x,this.window.end.y=s.y,this.editor.render(),this.window.render(this.editor.context))}updateIndicator(t,e){let s=this.editor.floor.getControlsOnCoordinates(t,e,(t=>"wall"===t.type));if(s.length<=0)return;const n=s[0].createClosestPoint(t,e);this.indicator.wall=s[0],this.indicator.point.x=n.x,this.indicator.point.y=n.y,this.editor.render()}}class et extends z{constructor(t){super(),this.handler=new st(t,{minimumLength:20})}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class st extends j{constructor(t,e){super(),this.editor=t,this.config=e,this.ruler=null,this.wall=null,this.door=null,this.indicator=new Q,this.editor.setSelectControls([this.indicator])}onMouseDown(t){let e=this.editor.floor.getControlsOnCoordinates(t.x,t.y,(t=>"wall"===t.type));if(e.length<=0)return;this.wall=e[0];const s=this.wall.createClosestPoint(t.x,t.y);this.door=new k(new o(s.x,s.y),new o(s.x,s.y)),this.ruler=new y(this.wall.start,this.wall.end),this.ruler.addPoint(this.door.start),this.ruler.addPoint(this.door.end),this.editor.setSelectControls([this.ruler])}onMouseMove(t){this.door?this.updateDoor(t.x,t.y):this.updateIndicator(t.x,t.y)}onMouseUp(t){this.door&&(this.editor.setSelectControls([]),this.door.length>this.config.minimumLength&&this.editor.floor.doors.push(this.door),this.wall=null,this.door=null,this.render=null,this.editor.render(),this.editor.tools.select(),this.editor.onChangeFloor())}updateDoor(t,e){const s=this.wall.createClosestPoint(t,e);this.wall.isPointOnBoundary(s)&&(this.door.end.x=s.x,this.door.end.y=s.y,this.editor.render(),this.door.render(this.editor.context))}updateIndicator(t,e){let s=this.editor.floor.getControlsOnCoordinates(t,e,(t=>"wall"===t.type));if(s.length<=0)return;const n=s[0].createClosestPoint(t,e);this.indicator.wall=s[0],this.indicator.point.x=n.x,this.indicator.point.y=n.y,this.editor.render()}}class nt extends z{constructor(t){super(),this.handler=new ot(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class ot extends j{constructor(t){super(),this.editor=t,this.control=new it(this),this.started=!0,this.start=new o(0,0),this.end=new o(0,0),this.cuttings=[]}onMouseDown(t){this.started=!0,this.start.x=t.x,this.start.y=t.y,this.end.x=t.x,this.end.y=t.y,this.editor.setSelectControls([this.control])}onMouseMove(t){this.end.x=t.x,this.end.y=t.y,this.started&&(this.createCutting(),this.editor.render())}onMouseUp(t){if(this.started){for(const t of this.cuttings)t.wall.cutting(this.editor.floor,t.point.x,t.point.y);this.started=!1,this.editor.render(),this.editor.tools.select(),this.cuttings=[]}this.editor.setSelectControls([])}createCutting(){this.cuttings=[];for(const t of this.editor.floor.walls){const e=n.interceptPoint(this.start.x,this.start.y,this.end.x,this.end.y,t.start.x,t.start.y,t.end.x,t.end.y);e&&this.cuttings.push({point:e,wall:t})}}}class it{constructor(t){this.handler=t}render(t){t.save(),this.renderLine(t),this.renderCuttings(t),t.restore()}renderLine(t){t.lineWidth=1,t.strokeStyle=x.Colors.Red50,t.beginPath(),t.setLineDash([5,10]),t.moveTo(this.handler.start.x,this.handler.start.y),t.lineTo(this.handler.end.x,this.handler.end.y),t.closePath(),t.stroke(),t.setLineDash([])}renderCuttings(t){for(const e of this.handler.cuttings)t.fillStyle=x.Colors.Red50,t.beginPath(),t.arc(e.point.x,e.point.y,10,0,2*Math.PI),t.closePath(),t.fill()}}class rt extends z{constructor(t){super(),this.handler=new at(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class at extends j{constructor(t){super(),this.editor=t,this.creator=new ht,this.started=!1}onMouseDown(t){this.started=!0,this.creator.start.x=t.snapX,this.creator.start.y=t.snapY,this.editor.floor.addForegroundControl(this.creator)}onMouseMove(t){this.started&&(this.creator.end.x=t.snapX,this.creator.end.y=t.snapY,this.editor.render())}onMouseUp(t){if(this.started){const e=t.snapX,s=t.snapY;this.editor.floor.createWall(this.creator.start.x,this.creator.start.y,e,s),this.editor.floor.removeForegroundControl(this.creator),this.editor.render(),this.editor.tools.select(),this.editor.onChangeFloor()}this.started=!1}}class ht extends s{constructor(){super(),this.start=new o(0,0),this.end=new o(0,0),this.ruler=new y(this.start,this.end)}render(t){t.lineWidth=10,t.strokeStyle="#0097c5",t.line(this.start.x,this.start.y,this.end.x,this.end.y),this.ruler.render(t)}}class lt{static createLine(t){return(e,s,n,o)=>{t.beginPath(),t.moveTo(e,s),t.lineTo(n,o),t.closePath(),t.stroke()}}static createText(t){return(e,s,n)=>{const o=t.measureText(n).width;t.fillText(n,e-o/2,s)}}static createCircle(t){return(e,s,n)=>{t.beginPath(),t.arc(e,s,n,0,2*Math.PI),t.closePath()}}static createArrow(t){return(e,s,n,o)=>{switch(o){case"up":t.beginPath(),t.moveTo(e,s),t.lineTo(e-n,s+n),t.lineTo(e+n,s+n),t.closePath(),t.fill();break;case"right":t.beginPath(),t.moveTo(e,s),t.lineTo(e-n,s-n),t.lineTo(e-n,s+n),t.closePath(),t.fill();break;case"down":t.beginPath(),t.moveTo(e,s),t.lineTo(e-n,s-n),t.lineTo(e+n,s-n),t.closePath(),t.fill();break;case"left":t.beginPath(),t.moveTo(e,s),t.lineTo(e+n,s-n),t.lineTo(e+n,s+n),t.closePath(),t.fill()}}}}class dt extends s{constructor(){super(),this.start=null,this.end=null,this.thick=10}render(t){this.start&&this.end&&(t.lineWidth=this.thick,t.strokeStyle="rgba(255, 59, 48, 0.7)",t.line(this.start.x,this.start.y,this.end.x,this.end.y),t.circle(this.start.x,this.start.y,10),t.circle(this.end.x,this.end.y,10))}}class ct extends z{constructor(t){super(),this.handler=new ut(t)}onCommandActive(t){t.addEventHandler(this.handler)}onCommandDeActive(t){t.removeEventHandler(this.handler)}}class ut extends j{constructor(t){super(),this.editor=t,this.control=null}useSnap(){return!1}onMouseDown(t){const e=this.findEraseControl(t.x,t.y);e&&(this.editor.floor.removeControl(e),this.hideControl(),this.editor.onChangeFloor())}onMouseMove(t){const e=this.findEraseControl(t.x,t.y);e?this.showControl(e.start,e.end):this.hideControl()}showControl(t,e){this.control||(this.control=new dt,this.editor.floor.addForegroundControl(this.control)),this.control.start===t&&this.control===e||(this.control.start=t,this.control.end=e,this.editor.render())}hideControl(){this.control&&(this.editor.floor.removeForegroundControl(this.control),this.control=null,this.editor.render())}findEraseControl(t,e){const s=this.editor.floor.getControlsOnCoordinates(t,e);if(0===s.length)return null;if(1===s.length)return s[0];for(const t of s)if("wall"!==t.type)return t;return null}}class xt extends z{constructor(t,e){super(),this.editor=t,this.scale=e}onCommandActive(t){this.editor.scale+=this.scale,this.editor.context.setTransform(this.editor.scale,0,0,this.editor.scale,0,0),this.editor.render(),this.editor.tools.select()}onCommandDeActive(t){}}class yt extends z{constructor(t){super(),this.editor=t}onCommandActive(t){this.editor.floor.clear(),this.editor.render(),this.editor.tools.select()}onCommandDeActive(t){}}class wt{static importData(t,e,s){new ft(4).importData(t,e,new gt(s))}static exportData(t){}}class gt{constructor(t){this.config=t,this.defaultRoomFillColor="rgba(131,208,221,0.5)"}getRoomFillColor(t){return this.config&&this.config.room&&this.config.room.colors&&this.config.room.colors.length>t?this.config.room.colors[t]:this.defaultRoomFillColor}}class ft{constructor(t){this.scale=t}importData(t,e,s){for(const n of e)"STR"===n.type?this.importSTR(t,n.categories,s):"SPA"===n.type&&this.importSPA(t,n.categories,s)}importSTR(t,e,s){for(const n of e)0!==n.category&&1!==n.category&&2!==n.category&&3!==n.category||this.importObjectFromSTR(t,n.category,n.objects,s)}importObjectFromSTR(t,e,s,n){for(const n of s){if("line"===n.type){const s=new o(n.data[0][0]*this.scale,n.data[0][1]*this.scale),i=new o(n.data[1][0]*this.scale,n.data[1][1]*this.scale);if(0===e||1===e){const n=new P(s,i);n.thick=1===e?7:10,t.walls.push(n)}else if(3===e){const e=new k(s,i);e.hidge=n.hinge??"start",e.direction=n.direction??"right",t.doors.push(e)}else if(2===e){const e=new q(s,i);t.windows.push(e)}}n.type}}importSPA(t,e,s){for(const n of e)11!==n.category&&this.importObjectFromSPA(t,n.category,n.objects,s)}importObjectFromSPA(t,e,s,n){const i=new Map([[0,"다목적공간"],[1,"엘리베이터"],[2,"계단"],[3,"객체_변기"],[4,"객체_세면대"],[5,"객체_싱크대"],[6,"객체_욕조"],[7,"객체_가스레인지"],[8,"구조_출입문"],[9,"구조_창호"],[10,"구조_벽체"],[11,"도면 영역"],[12,"거실"],[13,"침실"],[14,"주방"],[15,"현관"],[16,"발코니"],[17,"화장실"],[18,"실외기실"],[19,"드레스룸"],[20,"OCR"],[21,"기타"]]);for(const r of s)if("Polygon"===r.type){const s=i.get(e),a=new E([],s);for(const t of r.data)a.addPoint(new o(t[0]*this.scale,t[1]*this.scale));a.fillColor=n.getRoomFillColor(e),t.rooms.push(a)}else r.type}}class pt extends z{constructor(t){super(),this.editor=t}onCommandActive(t){const e=t.history.index;e>0&&e-1>0&&(t.floor.load(JSON.parse(t.history.data[e-1])),t.history.index--,t.render()),this.editor.tools.select()}onCommandDeActive(t){}}class Ct extends z{constructor(t){super(),this.editor=t}onCommandActive(t){const e=t.history.index;e<t.history.data.length&&(t.floor.load(JSON.parse(t.history.data[e])),t.history.index++,t.render()),this.editor.tools.select()}onCommandDeActive(t){}}class vt{constructor(){this.canvas=null,this.context=null,this.tools=new mt(this),this.floor=new I,this.backgroudFloor=new I,this.renders=[],this.scale=1,this.activeCommand=null,this.onSelectListener=null,this.eventController=new G,this.config=null,this.selects=[],this.history={index:-1,data:[]}}edit(t,e){if(this.config=e,window&&document){const s=document.querySelector(t);s?(s.tabIndex=1,s.style.outline="none",this.canvas=document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.tabindex=2,this.canvas.style.outline="none",this.context=this.canvas.getContext("2d"),this.initializeCanvas(s,window),s.appendChild(this.canvas),this.renders.push(new V(e.grid,this.canvas)),this.renders.push(new L(this.backgroudFloor,.1,!1)),this.renders.push(new L(this.floor,1,!1)),this.renders.push(new X(this.floor)),this.render(),this.canvas.focus()):console.log(`${t} 요소를 찾을 수 없습니다.`)}}import(t,e){wt.importData(this.backgroudFloor,t,e),wt.importData(this.floor,t,e),this.render()}export(){}initializeCanvas(t,e){if(e&&this.canvas&&this.context){this.context.line=lt.createLine(this.context),this.context.arrow=lt.createArrow(this.context),this.context.text=lt.createText(this.context),this.context.circle=lt.createCircle(this.context);const s=e.devicePixelRatio||1,n=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,o=s/n;if(this.scale=o,s!==n){const t=this.canvas.width,e=this.canvas.height;this.canvas.width=t*o,this.canvas.height=e*o,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.context.scale(o,o)}this.context.lineJoin="round",this.context.lineCap="square",this.context.imageSmoothingEnabled=!0,this.canvas.addEventListener("mousedown",(t=>{if(this.eventController){let[e,s]=this.getXYFromEvent(t);this.eventController.onMouseDown(e,s)}})),this.canvas.addEventListener("mousemove",(t=>{if(this.eventController){let[e,s]=this.getXYFromEvent(t);this.eventController.onMouseMove(e,s)}})),this.canvas.addEventListener("mouseup",(t=>{if(this.eventController){let[e,s]=this.getXYFromEvent(t);this.eventController.onMouseUp(e,s)}})),this.canvas.addEventListener("click",(t=>{this.eventController&&this.eventController.onClick(t.button)})),t.addEventListener("keydown",(t=>{this.eventController&&this.eventController.onKeyDown(t.key,t.code)})),this.eventController.context=this.context}else console.log(`fail to initialize canvas : {window : ${e}, canvas : ${this.canvas}, context : ${this.context}`)}translate(t,e){this.context.translate(t,e)}getXYFromEvent(t){const e=this.canvas.getBoundingClientRect(),s=this.canvas.width/e.width,n=this.canvas.height/e.height;return[(t.clientX-e.left)*s/this.scale,(t.clientY-e.top)*n/this.scale]}addEventHandler(t){this.eventController.addHandler(t)}removeEventHandler(t){this.eventController.removeHandler(t)}onSelect(t){this.onSelectListener=t}selectControl(t,e,s){this.onSelectListener&&this.onSelectListener(t,e,s)}addSelectControl(t){t&&this.selects.push(t)}setSelectControls(t){t&&(this.selects=t)}addSelectControls(t){console.log(t),t&&this.selects.push(...t)}removeAllSelectControl(){this.selects=[]}render(){this.renderBackground();for(const t of this.renders)t.render(this.context);for(const t of this.selects)t.render(this.context)}renderBackground(){let t="#ffffff";this.config&&(t=this.config.background?this.config.background:"#ffffff"),this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.restore()}onChangeFloor(){this.history.data.push(JSON.stringify(this.floor)),this.history.index++}}class mt{constructor(t){this.editor=t}undo(){this.deActiveCommand(),this.editor.activeCommand=new pt(this.editor),this.activeCommand()}redo(){this.deActiveCommand(),this.editor.activeCommand=new Ct(this.editor),this.activeCommand()}select(){this.deActiveCommand(),this.editor.activeCommand=new U(this.editor),this.activeCommand()}createWall(){this.deActiveCommand(),this.editor.activeCommand=new rt(this.editor),this.activeCommand()}createRectWall(t){this.deActiveCommand(),this.editor.activeCommand=new K(this.editor,t),this.activeCommand()}createDoor(){this.deActiveCommand(),this.editor.activeCommand=new et(this.editor),this.activeCommand()}createWindow(){this.deActiveCommand(),this.editor.activeCommand=new Z(this.editor),this.activeCommand()}splitWall(){this.deActiveCommand(),this.editor.activeCommand=new nt(this.editor),this.activeCommand()}eraseObject(){this.deActiveCommand(),this.editor.activeCommand=new ct(this.editor),this.activeCommand()}zoomIn(){this.deActiveCommand(),this.editor.activeCommand=new xt(this.editor,.1),this.activeCommand()}zoomOut(){this.deActiveCommand(),this.editor.activeCommand=new xt(this.editor,-.1),this.activeCommand()}clear(){this.deActiveCommand(),this.editor.activeCommand=new yt(this.editor),this.activeCommand()}deActiveCommand(){this.editor.activeCommand&&this.editor.activeCommand.onCommandDeActive(this.editor),this.editor.activeCommand=null}activeCommand(){this.editor.activeCommand&&this.editor.activeCommand.onCommandActive(this.editor)}}PlaceIn=e})();